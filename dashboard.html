<!DOCTYPE html>
<html lang="en">
<head>
  <style>
    /* Existing CSS styles */
    /* Add these styles to your existing CSS */
    
.modal-content {
  position: relative;
  max-height: 80vh; /* Limit the height of the modal */
  overflow-y: auto; /* Enable vertical scrolling */
  padding-bottom: 80px;
  
}
    .loading {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(0,0,0,.3);
  border-radius: 50%;
  border-top-color: #2563eb;
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.loading-container {
  display: flex;
  justify-content: center;
  padding: 20px;
}
    .pending-tasks-card {
  background-color: inherit;
  padding: 6px;
  border-radius: 8px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.dark .pending-tasks-card {
  background-color: inherit;
}

.stock-table, .service-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}

.stock-table th, .stock-table td, .service-table th, .service-table td {
  padding: 12px;
  border: 1px solid #e5e7eb;
  text-align: left;
}

.stock-table th, .service-table th {
  background-color: #f9fafb;
  font-weight: 600;
  color: #374151;
}

.stock-table tr:hover, .service-table tr:hover {
  background-color: #f3f4f6;
}

.dark .stock-table th, .dark .stock-table td, .dark .service-table th, .dark .service-table td {
  border-color: #374151;
}

.dark .stock-table th, .dark .service-table th {
  background-color: #1f2937;
  color: #f9fafb;
}

.dark .stock-table tr:hover, .dark .service-table tr:hover {
  background-color: #374151;
}
    .overview {
      font-size: 34px;
      text-align: center;
      background-color: rgb(19, 19, 71);
      margin-bottom: 15px;
      color: white;
    }
    .product-item .product-type {
      margin: 0 10px;
      color: #666;
      font-style: italic;
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      position: relative;
    }
    .dark .modal-content {
      background-color: #1f2937;
      color: white;
    }
    .stock-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    .stock-table th, .stock-table td {
      padding: 12px;
      border: 1px solid #e5e7eb;
      text-align: left;
    }
    .stock-table th {
      background-color: #f9fafb;
      font-weight: 600;
      color: #374151;
    }
    .stock-table tr:hover {
      background-color: #f3f4f6;
    }
    .dark .stock-table th, .dark .stock-table td {
      border-color: #374151;
    }
    .dark .stock-table th {
      background-color: #1f2937;
      color: #f9fafb;
    }
    .dark .stock-table tr:hover {
      background-color: #374151;
    }
    .hidden {
      display: none;
    }
    .gray-button {
      background-color: #6b7280;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      text-align: center;
      display: inline-block;
      width: auto;
      margin: 5px;
      border: 1px solid black;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
    }
    .gray-button:hover {
      background-color: #4b5563;
    }
    .close-button {
  position: absolute; /* Fix the close button position */
  bottom: 20px; /* Distance from the bottom */
  right: 20px; /* Distance from the right */
  background-color: #ef4444;
  color: white;
  padding: 10px 20px;
  border-radius: 5px;
  text-align: center;
  display: inline-block;
  width: auto;
  margin: 5px;
  border: 1px solid black;
  box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
  z-index: 1000; /* Ensure the button stays on top of other content */
}
    .close-button:hover {
      background-color: #dc2626;
    }
    .product-card, .services-card, .make-sale-card, .finance-card {
      background-color: inherit;
      padding: 6px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .dark .product-card, .dark .services-card, .dark .make-sale-card, .dark .finance-card {
      background-color: inherit;
    }
    .quick-actions {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }
    .quick-actions .action-item {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #4b5563;
      cursor: pointer;
      transition: color 0.3s ease;
    }
    .quick-actions .action-item:hover {
      color: #1e40af;
    }
    .quick-actions .action-item .hover-text {
      display: none;
    }
    .quick-actions .action-item:hover .default-text {
      display: none;
    }
    .quick-actions .action-item:hover .hover-text {
      display: inline;
    }
    .finance-card {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      padding: 16px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .dark .finance-card {
      background-color: #1f2937;
    }
    .finance-item {
      text-align: center;
      flex: 1;
    }
    .finance-item .amount-box {
      background-color: #f3f4f6;
      padding: 8px;
      border-radius: 4px;
      margin-top: 8px;
    }
    .dark .finance-item .amount-box {
      background-color: #374151;
    }
    .product-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px;
      background-color: #f3f4f6;
      border-radius: 4px;
      margin-bottom: 4px;
    }
    .dark .product-item {
      background-color: #374151;
    }
    .product-item .actions {
      display: flex;
      gap: 8px;
    }
    .product-item .actions i {
      cursor: pointer;
      font-size: 16px;
    }
    .product-item .actions i:hover {
      opacity: 0.8;
    }
    .actions i {
      transition: color 0.2s ease;
    }
    .actions i:hover {
      opacity: 0.8;
    }
    /* Scrollable dropdowns */
    details > div {
      max-height: 150px;
      overflow-y: auto;
      border: 1px solid #e5e7eb;
      border-radius: 4px;
      padding: 8px;
      margin-top: 8px;
    }
    /* Add these styles to your existing CSS */
.gray-button {
  background-color: #6b7280;
  color: white;
  padding: 3px 6px; /* Reduced padding */
  border-radius: 5px;
  text-align: center;
  display: inline-block;
  width: auto;
  margin: 5px;
  border: 1px solid black;
  box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
  font-size: 12px; /* Reduced font size */
  font-weight: 500; /* Slightly bolder text */
}

.gray-button:hover {
  background-color: #4b5563;
}
   /* Notification dropdown container */
.notification-dropdown {
  position: relative;
  display: inline-block;
}

/* Notification icon and text */
.action-item {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  padding: 8px;
  border-radius: 4px;
  transition: background-color 0.3s ease;
}

.action-item:hover {
  background-color: #f3f4f6; /* Light gray background on hover */
}

/* Notification badge (red circle) */
.notification-badge {
  background-color: red;
  color: white;
  border-radius: 50%;
  padding: 2px 6px;
  font-size: 12px;
  position: absolute;
  top: -5px;
  right: -5px;
  display: none; /* Hidden by default */
}

/* Notification list (dropdown) */
.notification-list {
  position: absolute;
  right: 0;
  top: 40px; /* Position below the notification icon */
  background-color: white;
  border: 1px solid #ddd;
  border-radius: 8px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  max-height: 300px;
  overflow-y: auto;
  width: 300px;
  z-index: 1000;
  padding: 10px;
}

/* Scrollbar styling */
.notification-list::-webkit-scrollbar {
  width: 8px;
}

.notification-list::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 4px;
}

.notification-list::-webkit-scrollbar-thumb {
  background: #888;
  border-radius: 4px;
}

.notification-list::-webkit-scrollbar-thumb:hover {
  background: #555;
}

/* Hide notification list by default */
.notification-list.hidden {
  display: none;
}

/* Notification item */
.notification-item {
  padding: 10px;
  border-bottom: 1px solid #eee;
  cursor: pointer;
}

.notification-item:last-child {
  border-bottom: none;
}

/* Highlight unread notifications */
.notification-item.unread {
  background-color: #f0f8ff; /* Light blue background */
  font-weight: bold;
}

/* Hover effect */
.notification-item:hover {
  background-color: #f9f9f9;
}
    /* Notification list (dropdown) */
.notification-list {
  position: absolute;
  right: 0;
  top: 40px; /* Position below the notification icon */
  background-color: white;
  border: 1px solid #ddd;
  border-radius: 8px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  max-height: 150px; /* Limit height to show only 3 notifications */
  overflow-y: auto; /* Add scrollbar */
  width: 300px;
  z-index: 1000;
  padding: 10px;
}

/* Scrollbar styling */
.notification-list::-webkit-scrollbar {
  width: 8px;
}

.notification-list::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 4px;
}

.notification-list::-webkit-scrollbar-thumb {
  background: #888;
  border-radius: 4px;
}

.notification-list::-webkit-scrollbar-thumb:hover {
  background: #555;
}
    #pendingTasksList::-webkit-scrollbar {
    width: 6px;
  }

  #pendingTasksList::-webkit-scrollbar-track {
    background: transparent;
  }

  #pendingTasksList::-webkit-scrollbar-thumb {
    background-color: #888;
    border-radius: 8px;
  }

  #pendingTasksList::-webkit-scrollbar-thumb:hover {
    background-color: #555;
  }

  </style>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ndyakurungi ITECH Management System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</head>
<body class="bg-gray-100 dark:bg-gray-900">
  <!-- Header -->
<header class="bg-white dark:bg-gray-800 shadow">
  <div class="container mx-auto p-4 flex items-center justify-between">
    <div class="flex items-center">
      <div class="text-4xl text-blue-600 dark:text-blue-400 mr-4">
        <img src="Itech-computers-logo1.webp" alt="Itech Computers Logo">
      </div>
      <div>
        <h1 class="text-2xl font-bold dark:text-white">NDYAKURUNGI ITECH COMPUTER SOLUTIONS</h1>
        <p class="text-sm text-gray-600 dark:text-gray-400">Name it, we will provide & deliver it</p>
      </div>
    </div>
    <div class="flex items-center">
      <!-- Notification Dropdown -->
      <div class="notification-dropdown relative mr-4">
        
        <div class="action-item" onclick="toggleNotifications()">
          <i class="fas fa-bell text-gray-800 dark:text-yellow-400"></i>
          <span class="notification-badge" id="notification-count">0</span>
        </div>
        <div id="notification-list" class="notification-list hidden">
          <!-- Notifications will be dynamically added here -->
        </div>
      </div>
      <div class="action-item" onclick="window.location.href='notebook.html'">
          <i class="fas fa-book text-gray-800 dark:text-yellow-400"></i>
        </div>
      <!-- Theme Toggle Button -->
      <button id="themeToggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700">
        <i id="themeIcon" class="fas fa-moon text-gray-800 dark:text-yellow-400"></i>
      </button>
    </div>
  </div>
</header>
  <!-- Horizontal Quick Actions -->
 
  <div class="quick-actions">
    <div class="notification-dropdown">
  <div class="action-item" onclick="toggleNotifications()">
    <i class="fas fa-bell"></i>
    <span class="notification-badge" id="notification-count">0</span>
    <span class="default-text">Notifications</span>
    <span class="hover-text">Show Notifications</span>
  </div>
  <div id="notification-list" class="notification-list hidden">
    <!-- Notifications will be dynamically added here -->
  </div>
</div>
    <div class="action-item" onclick="openInvoiceModal()">
    <i class="fas fa-file-invoice"></i>
    <span class="default-text">Invoice</span>
    <span class="hover-text">Create Invoice</span>
  </div>
  <div class="action-item" onclick="openQuotationModal()">
    <i class="fas fa-file-alt"></i>
    <span class="default-text">Quotation</span>
    <span class="hover-text">Create Quotation</span>
  </div>
  <div class="action-item" onclick="openPaymentVoucherModal()">
    <i class="fas fa-money-check-alt"></i>
    <span class="default-text">Make Payment</span>
    <span class="hover-text">Create Payment Voucher</span>
  </div>
    <div class="action-item" onclick="openPaymentAcquisitionModal()">
    <i class="fas fa-money-check-alt"></i>
    <span class="default-text">Request Payment</span>
    <span class="hover-text">Create Payment acquisition</span>
  </div>
    
    <div class="action-item">
      <i class="fas fa-money-check-alt"></i>
      <a href="expenses.html">Daily Expenses</a>
    </div>
    <div class="action-item">
      <i class="fas fa-money-check-alt"></i>
      <a href="assets.html">Assets</a>
    </div>
    <div class="action-item" onclick="window.location.href='client-management.html'">
  <i class="fas fa-users"></i>
  <span class="default-text">Manage Clients</span>
  <span class="hover-text">Go to Client Management</span>
</div>
  </div>

  <!-- Main Content -->
  <div class="container mx-auto p-8">
    <!-- Product and Services Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <!-- Finance Card -->
      <div class="finance-card bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow">
        <div class="finance-item">
          <h3 class="text-lg font-semibold dark:text-white"><i class="fas fa-wallet mr-2"></i>Bank Account</h3>
          <div class="amount-box dark:text-white">0</div>
          <button onclick="openDepositModal()" class="gray-button">Deposit</button>
          <button onclick="openWithdrawModal()" class="gray-button">Withdraw</button>
          <button onclick="openTransactionHistoryModal()" class="gray-button">Transaction History</button>
        </div>
        <div class="finance-item">
          <h3 class="text-lg font-semibold dark:text-white"><i class="fas fa-chart-line mr-2"></i>Total Investment</h3>
          <div class="amount-box dark:text-white">0</div>
        </div>
        <div class="finance-item">
          <h3 class="text-lg font-semibold dark:text-white"><i class="fas fa-boxes mr-2"></i>Amount in Stock</h3>
          <div class="amount-box dark:text-white">0</div>
        </div>
        <div class="finance-item">
          <h3 class="text-lg font-semibold dark:text-white">
            <a href="profits.html" class="hover:underline">
              <i class="fas fa-coins mr-2"></i>Net Profit value
            </a>
          </h3>
          <div class="amount-box dark:text-white" id="netProfitAmount">0</div>
          <br>
          <br>
          <a href="make-sale.html" class="gray-button">
    <i class="fas fa-cash-register mr-2"></i>Make a Sale
  </a>
          
        </div>
      </div>
      <!-- Transaction History Modal -->
<div id="transactionHistoryModal" class="modal-overlay hidden">
  <div class="modal-content">
    <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-history mr-2"></i>Transaction History</h3>
    <table class="stock-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Type</th>
          <th>Amount</th>
          <th>Purpose</th>
        </tr>
      </thead>
      <tbody id="transactionHistoryTableBody">
        <!-- Transactions will be dynamically added here -->
      </tbody>
    </table>
    <button onclick="closeModal('transactionHistoryModal')" class="close-button">Close</button>
  </div>
</div>


<div class="pending-tasks-card bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow">
  <h2 class="text-xl font-semibold mb-4 dark:text-white">
    <i class="fas fa-tasks mr-2"></i>Pending Tasks
  </h2>

  <!-- Scrollable container -->
  <div id="pendingTasksList" class="space-y-2 max-h-64 overflow-y-auto pr-2">
    <!-- Example task items -->
    <div class="loading-container">
      <div class="loading"></div>
    </div>
    <!-- Example task -->
    <!--
    <div class="p-3 bg-gray-100 dark:bg-gray-700 rounded-md">
      Finish UI redesign
    </div>
    -->
  </div>
</div>

      <!-- Products Card -->
      <div class="product-card bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow">
        <h2 class="text-xl font-semibold mb-4 dark:text-white"><i class="fas fa-box-open mr-2"></i>Products Inventory</h2>
        <button onclick="openAddProductModal()" class="gray-button">
          <i class="fas fa-plus mr-2"></i>Add Product
        </button>
        <div class="mt-4">
          <details class="bg-gray-100 dark:bg-gray-700 p-2 rounded">
            <summary class="cursor-pointer dark:text-white">View Products</summary>
            <div id="productList" class="mt-2 space-y-2">
              <!-- Products will be dynamically added here -->
            </div>
          </details>
        </div>
        <button onclick="window.location.href='stock.html'" class="gray-button mt-4">
          <i class="fas fa-boxes mr-2"></i>Manage Stock
        </button>
      </div>

      <!-- Services Card -->
      <div class="services-card bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow">
        <h2 class="text-xl font-semibold mb-4 dark:text-white"><i class="fas fa-cogs mr-2"></i>Services Inventory</h2>
        <button onclick="openAddServiceModal()" class="gray-button">
          <i class="fas fa-plus mr-2"></i>Add Service
        </button>
        <div class="mt-4">
          <details class="bg-gray-100 dark:bg-gray-700 p-2 rounded">
            <summary class="cursor-pointer dark:text-white">View Services</summary>
            <div id="serviceList" class="mt-2 space-y-2">
              <!-- Services will be dynamically added here -->
            </div>
          </details>
        </div>
        <button onclick="openServiceManagementModal()" class="gray-button mt-4">
          <i class="fas fa-cogs mr-2"></i>Manage Services
        </button>
      </div>
    </div>
    <!-- Overview Section -->
<h1 class="overview">Overview</h1>
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
  <!-- Total Sales Card -->
  <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-6 rounded-lg shadow text-white">
    <h3 class="text-lg font-semibold"><i class="fas fa-chart-line mr-2"></i>Total Sales</h3>
    <p class="text-2xl font-bold">Ugx<span id="totalSales">0</span></p>
  </div>
  <!-- Gross Profit Card -->
  <div class="bg-gradient-to-r from-green-500 to-green-600 p-6 rounded-lg shadow text-white">
    <h3 class="text-lg font-semibold"><i class="fas fa-coins mr-2"></i>Gross Profit</h3>
    <p class="text-2xl font-bold">Ugx<span id="grossProfit">0</span></p>
  </div>
  <!-- Total Expenses Card -->
  <div class="bg-gradient-to-r from-purple-500 to-purple-600 p-6 rounded-lg shadow text-white">
    <h3 class="text-lg font-semibold"><i class="fas fa-money-bill-wave mr-2"></i>Total Expenses</h3>
    <p class="text-2xl font-bold">Ugx<span id="totalExpenses">0</span></p>
  </div>
  <!-- Debtors Balance Card -->
  <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 p-6 rounded-lg shadow text-white">
    <h3 class="text-lg font-semibold"><i class="fas fa-hand-holding-usd mr-2"></i>Debtors Balance</h3>
    <p class="text-2xl font-bold">Ugx<span id="debtorsBalance">0</span></p>
  </div>
  <!-- Net Profit Card -->
  <div class="bg-gradient-to-r from-pink-500 to-pink-600 p-6 rounded-lg shadow text-white">
    <h3 class="text-lg font-semibold"><i class="fas fa-chart-pie mr-2"></i>Net Profit</h3>
    <p class="text-2xl font-bold">Ugx<span id="netProfit">0</span></p>
  </div>
  <!-- Stock Balance Card -->
  <div class="bg-gradient-to-r from-indigo-500 to-indigo-600 p-6 rounded-lg shadow text-white">
    <h3 class="text-lg font-semibold"><i class="fas fa-boxes mr-2"></i>Stock Balance</h3>
    <p class="text-2xl font-bold">Ugx<span id="stockBalance">0</span></p>
  </div>
</div>
    
<!-- Bar Graph for Sales Analysis -->
<div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow mb-8">
  <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-chart-bar mr-2"></i>Sales Analysis (Last 6 Months)</h3>
  <canvas id="salesBarChart"></canvas>
</div>

<!-- Recent Transactions -->
<div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
  <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-receipt mr-2"></i>Last 3 Transactions</h3>
  <ul id="recentTransactions" class="space-y-2">
    <!-- Transactions will be dynamically added here -->
  </ul>
</div>

<!-- Pie Chart for Essential Features -->
<div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow mb-8">
  <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-chart-pie mr-2"></i>Profit Breakdown</h3>
  <canvas id="profitPieChart"></canvas>
</div>
  <!-- Add Product Modal -->
  <div id="addProductModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-plus mr-2"></i>Product inventory</h3>
      <form id="addProductForm">
        <input type="text" placeholder="Product Name" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <input type="text" placeholder="Product Type" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <input type="number" placeholder="Buying Price" id="buyingPriceInput" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <input type="number" placeholder="Selling Price" id="sellingPriceInput" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required readonly>
        <button type="submit" class="gray-button">Add Product</button>
      </form>
      <button onclick="closeModal('addProductModal')" class="close-button">Close</button>
    </div>
  </div>

  <!-- Stock Management Modal -->
  <div id="stockManagementModal" class="modal-overlay hidden">
  <div class="modal-content">
    <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-boxes mr-2"></i>Manage Stock</h3>
    <table class="stock-table">
      <thead>
        <tr>
          <th>Product Name</th>
          <th>Available Quantity</th>
          <th>Total Invested</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="stockTableBody">
        <!-- Stock items will be dynamically added here -->
      </tbody>
    </table>
    <button onclick="openAddStockModal()" class="gray-button mt-4">
      <i class="fas fa-plus mr-2"></i>Add New Quantity
    </button>
    <button onclick="closeModal('stockManagementModal')" class="close-button">Close</button>
  </div>
</div>

  <!-- Add Stock Modal -->
  <div id="addStockModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-plus mr-2"></i>Add New Quantity</h3>
      <form id="addStockForm">
        <select id="stockItemSelect" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
          <option value="" disabled selected>Select Product</option>
          <!-- Product options will be dynamically added here -->
        </select>
        <input type="number" id="defaultUnitPriceInput" placeholder="Default Unit Price" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required readonly>
        <input type="number" placeholder="Quantity" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <input type="number" placeholder="Price per Unit" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <button type="submit" class="gray-button">Add Quantity</button>
      </form>
      <button onclick="closeModal('addStockModal')" class="close-button">Close</button>
    </div>
  </div>

  <!-- Edit Stock Modal -->
<div id="editStockModal" class="modal-overlay hidden">
  <div class="modal-content">
    <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-edit mr-2"></i>Edit Stock</h3>
    <form id="editStockForm">
      <input type="hidden" id="editProductName" value="">
      <input type="hidden" id="editProductType" value="">
      <input type="number" id="editQuantity" placeholder="Quantity" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
      <input type="number" id="editPricePerUnit" placeholder="Price per Unit" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
      <button type="submit" class="gray-button">Update Stock</button>
    </form>
    <button onclick="closeModal('editStockModal')" class="close-button">Close</button>
  </div>
</div>

  <!-- Product Details Modal -->
  <div id="productDetailsModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3 id="productDetailsTitle" class="text-lg font-semibold mb-4 dark:text-white"></h3>
      <table class="stock-table">
        <tr>
          <th class="p-2">Product Type</th>
          <td id="productType" class="p-2"></td>
        </tr>
        <tr>
          <th class="p-2">Buying Price</th>
          <td id="buyingPrice" class="p-2"></td>
        </tr>
        <tr>
          <th class="p-2">Selling Price</th>
          <td id="sellingPrice" class="p-2"></td>
        </tr>
        <tr>
          <th class="p-2">Markup Profit (10%)</th>
          <td id="markupProfit" class="p-2"></td>
        </tr>
      </table>
      <button onclick="closeModal('productDetailsModal')" class="close-button">Close</button>
    </div>
  </div>

  <!-- Add Service Modal -->
  <div id="addServiceModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-plus mr-2"></i>Add Service</h3>
      <form id="addServiceForm">
        <input type="text" placeholder="Service Name" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <input type="text" placeholder="Service Description" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <input type="number" placeholder="Service Price" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <button type="submit" class="gray-button">Add Service</button>
      </form>
      <button onclick="closeModal('addServiceModal')" class="close-button">Close</button>
    </div>
  </div>

  <!-- Service Management Modal -->
  <div id="serviceManagementModal" class="modal-overlay hidden">
  <div class="modal-content">
    <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-cogs mr-2"></i>Manage Services</h3>
    <table class="service-table">
      <thead>
        <tr>
          <th>Service Name</th>
          <th>Description</th>
          <th>Price</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="serviceTableBody">
        <!-- Services will be dynamically added here -->
      </tbody>
    </table>
    <button onclick="closeModal('serviceManagementModal')" class="close-button">Close</button>
  </div>
</div>
  
<!-- Deposit Modal -->
  <div id="depositModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-plus mr-2"></i>Deposit</h3>
      <form id="depositForm">
        <input type="number" placeholder="Amount" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <input type="text" placeholder="Purpose" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <button type="submit" class="gray-button">Deposit</button>
      </form>
      <button onclick="closeModal('depositModal')" class="close-button">Close</button>
    </div>
  </div>

  <!-- Withdraw Modal -->
  <div id="withdrawModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-minus mr-2"></i>Withdraw</h3>
      <form id="withdrawForm">
        <input type="number" placeholder="Amount" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <input type="text" placeholder="Purpose" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <button type="submit" class="gray-button">Withdraw</button>
      </form>
      <button onclick="closeModal('withdrawModal')" class="close-button">Close</button>
    </div>
  </div>

    <div id="quotationModal" class="modal-overlay hidden">
  <div class="modal-content">
    <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-file-alt mr-2"></i>Create Quotation</h3>
    <form id="quotationForm" class="space-y-4">
      <div class="grid grid-cols-2 gap-4">
        <input type="text" placeholder="Customer Name" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
        <input type="text" placeholder="Route #" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <input type="text" placeholder="Customer Address" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
        <input type="date" placeholder="Route Date" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      </div>
      <input type="date" placeholder="Dec Date" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      <div id="quotationItems" class="space-y-2">
        <div class="grid grid-cols-4 gap-2">
          <input type="text" placeholder="Item Description" class="p-2 border rounded dark:bg-gray-700 dark:text-white" required>
          <input type="number" placeholder="Quantity" class="p-2 border rounded dark:bg-gray-700 dark:text-white" required>
          <input type="number" placeholder="Unit Price" class="p-2 border rounded dark:bg-gray-700 dark:text-white" required>
          <input type="number" placeholder="Total" class="p-2 border rounded dark:bg-gray-700 dark:text-white" readonly>
        </div>
      </div>
      <button type="button" onclick="addQuotationItem()" class="gray-button">Add Item</button>
      <button type="submit" class="gray-button w-full">Generate Quotation PDF</button>
    </form>
    <button onclick="closeModal('quotationModal')" class="close-button">Close</button>
  </div>
</div>

    <!-- Payment Acquisition Form Modal -->
<div id="paymentAcquisitionModal" class="modal-overlay hidden">
  <div class="modal-content">
    <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-money-check-alt mr-2"></i>Payment Acquisition Form</h3>
    <form id="paymentAcquisitionForm" class="space-y-4">
      <div class="grid grid-cols-2 gap-4">
        <input type="text" placeholder="Payer Name" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
        <input type="text" placeholder="Payer Address" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <input type="text" placeholder="Payer Phone" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
        <input type="email" placeholder="Payer Email" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <input type="text" placeholder="Payment Reference Number" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
        <input type="date" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <input type="text" placeholder="Payment Method" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
        <input type="number" placeholder="Amount Paid" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      </div>
      <textarea placeholder="Payment Description" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" rows="3"></textarea>
      <button type="submit" class="gray-button w-full">Generate Payment Receipt PDF</button>
    </form>
    <button onclick="closeModal('paymentAcquisitionModal')" class="close-button">Close</button>
  </div>
</div>

   <!-- Payment Voucher Modal -->
<div id="paymentVoucherModal" class="modal-overlay hidden">
  <div class="modal-content">
    <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-money-check-alt mr-2"></i>Create Payment Voucher</h3>
    <form id="paymentVoucherForm" class="space-y-4">
      <div class="grid grid-cols-2 gap-4">
        <input type="text" placeholder="Company Name" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
        <input type="text" placeholder="Address" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <input type="text" placeholder="Contact No." class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
        <input type="email" placeholder="E-mail ID" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <input type="text" placeholder="Pay To" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
        <input type="text" placeholder="Pay By" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      </div>
      <input type="date" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      <input type="text" placeholder="Serial No." class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      <input type="text" placeholder="Payment Method" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      <div id="paymentItems" class="space-y-2">
        <div class="grid grid-cols-4 gap-2">
          <input type="text" placeholder="Item Description" class="p-2 border rounded dark:bg-gray-700 dark:text-white" required>
          <input type="number" placeholder="Quantity" class="p-2 border rounded dark:bg-gray-700 dark:text-white" required>
          <input type="number" placeholder="Unit Price" class="p-2 border rounded dark:bg-gray-700 dark:text-white" required>
          <input type="number" placeholder="Total" class="p-2 border rounded dark:bg-gray-700 dark:text-white" readonly>
        </div>
      </div>
      <button type="button" onclick="addPaymentItem()" class="gray-button">Add Item</button>
      <button type="submit" class="gray-button w-full">Generate Payment Voucher PDF</button>
    </form>
    <button onclick="closeModal('paymentVoucherModal')" class="close-button">Close</button>
  </div>
</div>

   <!-- Invoice Modal -->
<div id="invoiceModal" class="modal-overlay hidden">
  <div class="modal-content">
    <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-file-invoice mr-2"></i>Create Invoice</h3>
    <form id="invoiceForm" class="space-y-4">
      <div class="grid grid-cols-2 gap-4">
        <input type="text" placeholder="Your Company Name" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
        <input type="text" placeholder="Address" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <input type="text" placeholder="Phone" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
        <input type="text" placeholder="Purchase Order Number" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      </div>
      <input type="date" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      <div id="invoiceItems" class="space-y-2">
        <div class="grid grid-cols-4 gap-2">
          <input type="text" placeholder="Item Description" class="p-2 border rounded dark:bg-gray-700 dark:text-white" required>
          <input type="number" placeholder="Quantity" class="p-2 border rounded dark:bg-gray-700 dark:text-white" required>
          <input type="number" placeholder="Unit Price" class="p-2 border rounded dark:bg-gray-700 dark:text-white" required>
          <input type="number" placeholder="Total" class="p-2 border rounded dark:bg-gray-700 dark:text-white" readonly>
        </div>
      </div>
      <button type="button" onclick="addInvoiceItem()" class="gray-button">Add Item</button>
      <button type="submit" class="gray-button w-full">Generate Invoice PDF</button>
    </form>
    <button onclick="closeModal('invoiceModal')" class="close-button">Close</button>
  </div>
</div>

    
  <!-- JavaScript -->
  <script>
    const backendUrl = 'https://man-m681.onrender.com'; // Replace with your Render backend URL

    function openInvoiceModal() {
    document.getElementById('invoiceModal').classList.remove('hidden');
  }

  function addInvoiceItem() {
    const invoiceItems = document.getElementById('invoiceItems');
    const newItem = document.createElement('div');
    newItem.classList.add('grid', 'grid-cols-4', 'gap-2');
    newItem.innerHTML = `
      <input type="text" placeholder="Item Description" class="p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      <input type="number" placeholder="Quantity" class="p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      <input type="number" placeholder="Unit Price" class="p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      <input type="number" placeholder="Total" class="p-2 border rounded dark:bg-gray-700 dark:text-white" readonly>
    `;
    invoiceItems.appendChild(newItem);
  }

  document.getElementById('invoiceForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const companyName = e.target[0].value;
    const address = e.target[1].value;
    const phone = e.target[2].value;
    const purchaseOrderNumber = e.target[3].value;
    const date = e.target[4].value;

    const items = [];
    const itemRows = document.querySelectorAll('#invoiceItems .grid');
    itemRows.forEach(row => {
      const description = row.children[0].value;
      const quantity = row.children[1].value;
      const unitPrice = row.children[2].value;
      const total = row.children[3].value;
      items.push({ description, quantity, unitPrice, total });
    });

    // Generate PDF
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Add Logo
    const logo = await loadImage('Itech-computers-logo1.webp');
    doc.addImage(logo, 'PNG', 10, 10, 50, 20);

    // Invoice Header
    doc.setFontSize(18);
    doc.text("INVOICE", 10, 40);
    doc.setFontSize(12);
    doc.text(`Company Name: ${companyName}`, 10, 50);
    doc.text(`Address: ${address}`, 10, 60);
    doc.text(`Phone: ${phone}`, 10, 70);
    doc.text(`Purchase Order Number: ${purchaseOrderNumber}`, 10, 80);
    doc.text(`Date: ${date}`, 10, 90);

    // Invoice Table
    const tableData = items.map(item => [item.description, item.quantity, `${item.unitPrice}`, `${item.total}`]);
    doc.autoTable({
      startY: 100,
      head: [['Description', 'Quantity', 'Unit Price', 'Total']],
      body: tableData,
    });

    // Save PDF
    doc.save(`Invoice_${purchaseOrderNumber}.pdf`);

    closeModal('invoiceModal');
  });

  async function loadImage(src) {
    return new Promise((resolve) => {
      const img = new Image();
      img.src = src;
      img.onload = () => resolve(img);
    });
  }
    function openPaymentVoucherModal() {
    document.getElementById('paymentVoucherModal').classList.remove('hidden');
  }

  function addPaymentItem() {
    const paymentItems = document.getElementById('paymentItems');
    const newItem = document.createElement('div');
    newItem.classList.add('grid', 'grid-cols-4', 'gap-2');
    newItem.innerHTML = `
      <input type="text" placeholder="Item Description" class="p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      <input type="number" placeholder="Quantity" class="p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      <input type="number" placeholder="Unit Price" class="p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      <input type="number" placeholder="Total" class="p-2 border rounded dark:bg-gray-700 dark:text-white" readonly>
    `;
    paymentItems.appendChild(newItem);
  }

  document.getElementById('paymentVoucherForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const companyName = e.target[0].value;
    const address = e.target[1].value;
    const contactNo = e.target[2].value;
    const email = e.target[3].value;
    const payTo = e.target[4].value;
    const payBy = e.target[5].value;
    const date = e.target[6].value;
    const serialNo = e.target[7].value;
    const paymentMethod = e.target[8].value;

    const items = [];
    const itemRows = document.querySelectorAll('#paymentItems .grid');
    itemRows.forEach(row => {
      const description = row.children[0].value;
      const quantity = row.children[1].value;
      const unitPrice = row.children[2].value;
      const total = row.children[3].value;
      items.push({ description, quantity, unitPrice, total });
    });

    // Generate PDF
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Add Logo
    const logo = await loadImage('Itech-computers-logo1.webp');
    doc.addImage(logo, 'PNG', 10, 10, 50, 20);

    // Payment Voucher Header
    doc.setFontSize(18);
    doc.text("PAYMENT VOUCHER", 10, 40);

    // Company Details
    doc.setFontSize(12);
    doc.text(`Company Name: ${companyName}`, 10, 50);
    doc.text(`Address: ${address}`, 10, 60);
    doc.text(`Contact No.: ${contactNo}`, 10, 70);
    doc.text(`E-mail ID: ${email}`, 10, 80);

    // Payment Details
    doc.text(`Pay To: ${payTo}`, 10, 90);
    doc.text(`Pay By: ${payBy}`, 10, 100);
    doc.text(`Date: ${date}`, 10, 110);
    doc.text(`Serial No.: ${serialNo}`, 10, 120);
    doc.text(`Payment Method: ${paymentMethod}`, 10, 130);

    // Payment Items Table
    const tableData = items.map(item => [item.description, item.quantity, `$${item.unitPrice}`, `$${item.total}`]);
    doc.autoTable({
      startY: 140,
      head: [['Description', 'Quantity', 'Unit Price', 'Total']],
      body: tableData,
    });

    // Total Amount
    const totalAmount = items.reduce((sum, item) => sum + parseFloat(item.total), 0);
    doc.setFontSize(14);
    doc.text(`Total Amount: $${totalAmount.toFixed(2)}`, 10, doc.lastAutoTable.finalY + 10);

    // Save PDF
    doc.save(`Payment_Voucher_${serialNo}.pdf`);

    closeModal('paymentVoucherModal');
  });

  async function loadImage(src) {
    return new Promise((resolve) => {
      const img = new Image();
      img.src = src;
      img.onload = () => resolve(img);
    });
  }

    function openQuotationModal() {
    document.getElementById('quotationModal').classList.remove('hidden');
  }

  function addQuotationItem() {
    const quotationItems = document.getElementById('quotationItems');
    const newItem = document.createElement('div');
    newItem.classList.add('grid', 'grid-cols-4', 'gap-2');
    newItem.innerHTML = `
      <input type="text" placeholder="Item Description" class="p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      <input type="number" placeholder="Quantity" class="p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      <input type="number" placeholder="Unit Price" class="p-2 border rounded dark:bg-gray-700 dark:text-white" required>
      <input type="number" placeholder="Total" class="p-2 border rounded dark:bg-gray-700 dark:text-white" readonly>
    `;
    quotationItems.appendChild(newItem);
  }

  document.getElementById('quotationForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const customerName = e.target[0].value;
    const routeNumber = e.target[1].value;
    const customerAddress = e.target[2].value;
    const routeDate = e.target[3].value;
    const decDate = e.target[4].value;

    const items = [];
    const itemRows = document.querySelectorAll('#quotationItems .grid');
    itemRows.forEach(row => {
      const description = row.children[0].value;
      const quantity = row.children[1].value;
      const unitPrice = row.children[2].value;
      const total = row.children[3].value;
      items.push({ description, quantity, unitPrice, total });
    });

    // Generate PDF
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Add Logo
    const logo = await loadImage('Itech-computers-logo1.webp');
    doc.addImage(logo, 'PNG', 10, 10, 50, 20);

    // Quotation Header
    doc.setFontSize(18);
    doc.text("QUOTATION", 10, 40);
    doc.setFontSize(12);
    doc.text(`Customer Name: ${customerName}`, 10, 50);
    doc.text(`Route #: ${routeNumber}`, 10, 60);
    doc.text(`Customer Address: ${customerAddress}`, 10, 70);
    doc.text(`Route Date: ${routeDate}`, 10, 80);
    doc.text(`Dec Date: ${decDate}`, 10, 90);

    // Quotation Table
    const tableData = items.map(item => [item.description, item.quantity, `${item.unitPrice}`, `${item.total}`]);
    doc.autoTable({
      startY: 100,
      head: [['Description', 'Quantity', 'Unit Price', 'Total']],
      body: tableData,
    });

    // Save PDF
    doc.save(`Quotation_${routeNumber}.pdf`);

    closeModal('quotationModal');
  });

    // Dark/Light Mode Toggle
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    themeToggle.addEventListener('click', () => {
      const htmlElement = document.documentElement;
      htmlElement.classList.toggle('dark');
      
      if (htmlElement.classList.contains('dark')) {
        themeIcon.classList.remove('fa-moon');
        themeIcon.classList.add('fa-sun');
      } else {
        themeIcon.classList.remove('fa-sun');
        themeIcon.classList.add('fa-moon');
      }
    });
    // Open Deposit Modal
    function openDepositModal() {
      document.getElementById('depositModal').classList.remove('hidden');
    }

    // Open Withdraw Modal
    function openWithdrawModal() {
      document.getElementById('withdrawModal').classList.remove('hidden');
    }
    // Deposit Form Submission
    document.getElementById('depositForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const amount = parseFloat(e.target[0].value);
      const purpose = e.target[1].value;

      const response = await fetch(`${backendUrl}/bank_account/`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          balance: amount,
          purpose: purpose
        })
      });

      if (response.ok) {
        alert('Deposit successful!');
        e.target.reset();
        closeModal('depositModal');
        fetchBankAccountBalance();
      } else {
        alert('Failed to deposit');
      }
    });

    // Withdraw Form Submission
    document.getElementById('withdrawForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const amount = parseFloat(e.target[0].value);
      const purpose = e.target[1].value;

      const response = await fetch(`${backendUrl}/bank_account/`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          balance: -amount,
          purpose: purpose
        })
      });

      if (response.ok) {
        alert('Withdrawal successful!');
        e.target.reset();
        closeModal('withdrawModal');
        fetchBankAccountBalance();
      } else {
        alert('Failed to withdraw');
      }
    });

    // Initialize
    fetchBankAccountBalance();


    // Fetch and display bank account balance
    async function fetchBankAccountBalance() {
      const response = await fetch(`${backendUrl}/bank_account/`);
      const data = await response.json();
      document.querySelector('.finance-item .amount-box').textContent = `UGX ${data.balance.toLocaleString()}`;
    }

    // Initialize
    fetchBankAccountBalance();

    // Open Add Product Modal
    function openAddProductModal() {
      document.getElementById('addProductModal').classList.remove('hidden');
    }

    // Open Stock Management Modal
    function openStockManagementModal() {
  document.getElementById('stockManagementModal').classList.remove('hidden');
  fetchStock();
}

    // Open Add Stock Modal
    function openAddStockModal() {
    fetchProducts().then(products => {
        const stockItemSelect = document.getElementById('stockItemSelect');
        stockItemSelect.innerHTML = '<option value="" disabled selected>Select Product</option>' +
            products.map(product => `<option value="${product.name}" data-buying-price="${product.buying_price}" data-product-type="${product.type}">${product.name} (${product.type})</option>`).join('');
    });
    document.getElementById('addStockModal').classList.remove('hidden');
}

    // Populate Default Unit Price when Product is selected
    document.getElementById('stockItemSelect').addEventListener('change', (e) => {
      const selectedProduct = e.target.options[e.target.selectedIndex];
      const buyingPrice = selectedProduct.getAttribute('data-buying-price');
      document.getElementById('defaultUnitPriceInput').value = buyingPrice || '';
    });

    // Open Add Service Modal
    function openAddServiceModal() {
      document.getElementById('addServiceModal').classList.remove('hidden');
    }

    // Open Service Management Modal
    function openServiceManagementModal() {
  document.getElementById('serviceManagementModal').classList.remove('hidden');
  fetchServices();
}

    // Close Modals
    function closeModal(modalId) {
      document.getElementById(modalId).classList.add('hidden');
    }

    // Add Product
    document.getElementById('addProductForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const productName = e.target[0].value;
      const productType = e.target[1].value;
      const buyingPrice = parseFloat(e.target[2].value);
      const sellingPrice = parseFloat(e.target[3].value);

      const response = await fetch(`${backendUrl}/products/`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          name: productName,
          type: productType,
          buying_price: buyingPrice,
          selling_price: sellingPrice
        })
      });

      if (response.ok) {
        alert('Product added successfully!');
        e.target.reset();
        closeModal('addProductModal');
        fetchProducts();
      } else {
        alert('Failed to add product');
      }
    });

    // Add Stock
// Example: Update total investment after adding stock
document.getElementById('addStockForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const productName = document.getElementById('stockItemSelect').value;
  const selectedProduct = document.getElementById('stockItemSelect').options[document.getElementById('stockItemSelect').selectedIndex];
  const productType = selectedProduct.getAttribute('data-product-type');
  const quantity = parseFloat(e.target[2].value);
  const pricePerUnit = parseFloat(e.target[3].value);

  const response = await fetch(`${backendUrl}/stock/`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      product_name: productName,
      product_type: productType,
      quantity: quantity,
      price_per_unit: pricePerUnit
    })
  });

  if (response.ok) {
    alert('Stock added successfully!');
    e.target.reset();
    closeModal('addStockModal');
    fetchStock();
    updateTotalInvested(); // Update the total investment
  } else {
    alert('Failed to add stock');
  }
});
// Function to update the total invested amount in the finance card
async function updateTotalInvested() {
    const response = await fetch(`${backendUrl}/stock/`);
    const data = await response.json();
    let totalInvested = 0;

    data.stock.forEach(item => {
        totalInvested += item.quantity * item.price_per_unit;
    });

    document.querySelector('.finance-item:nth-child(3) .amount-box').textContent = `UGX ${totalInvested.toLocaleString()}`;
}


// Initialize
fetchProducts();
fetchStock();
fetchServices();
updateTotalInvested();   

    // Add Service
    document.getElementById('addServiceForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const serviceName = e.target[0].value;
      const serviceDescription = e.target[1].value;
      const servicePrice = parseFloat(e.target[2].value);

      const response = await fetch(`${backendUrl}/services/`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          name: serviceName,
          description: serviceDescription,
          price: servicePrice
        })
      });

      if (response.ok) {
        alert('Service added successfully!');
        e.target.reset();
        closeModal('addServiceModal');
        fetchServices();
      } else {
        alert('Failed to add service');
      }
    });

    // Fetch Products
    async function fetchProducts() {
      const response = await fetch(`${backendUrl}/products/`);
      const data = await response.json();
      const productList = document.getElementById('productList');
      productList.innerHTML = data.products.map(product => `
        <div class="product-item">
          <span>${product.name} (${product.type})</span>
          <div class="actions">
            <i class="fas fa-trash text-red-500" onclick="deleteProduct('${product.name}', '${product.type}')"></i>
            <i class="fas fa-edit text-blue-500" onclick="editProduct('${product.name}', '${product.type}', ${product.buying_price}, ${product.selling_price})"></i>
            <i class="fas fa-eye text-green-500" onclick="showProductDetails('${product.name}', '${product.type}', ${product.buying_price}, ${product.selling_price})"></i>
          </div>
        </div>
      `).join('');
      return data.products;
    }

    // Fetch Stock
async function fetchStock() {
  const response = await fetch(`${backendUrl}/stock/`);
  const data = await response.json();
  const stockTableBody = document.getElementById('stockTableBody');
  stockTableBody.innerHTML = data.stock.map(item => `
    <tr>
      <td>${item.product_name}</td>
      <td>${item.quantity}</td>
      <td>UGX ${(item.price_per_unit * item.quantity).toLocaleString()}</td>
      <td class="actions">
        <i class="fas fa-trash text-red-500 hover:text-red-700 cursor-pointer" onclick="deleteStockItem('${item.product_name}', '${item.product_type}')"></i>
        <i class="fas fa-edit text-blue-500 hover:text-blue-700 cursor-pointer ml-2" onclick="editStockItem('${item.product_name}', '${item.product_type}', ${item.quantity}, ${item.price_per_unit})"></i>
        <i class="fas fa-eye text-green-500 hover:text-green-700 cursor-pointer ml-2" onclick="viewStockItem('${item.product_name}', '${item.product_type}', ${item.quantity}, ${item.price_per_unit})"></i>
      </td>
    </tr>
  `).join('');

  updateTotalInvested(); // Update the total invested amount in the finance card
}

// Fetch Services
 async function fetchServices() {
      const response = await fetch(`${backendUrl}/services/`);
      const data = await response.json();
      const serviceList = document.getElementById('serviceList');
      const serviceTableBody = document.getElementById('serviceTableBody');

      serviceList.innerHTML = data.services.map(service => `
        <div class="p-2 bg-gray-200 dark:bg-gray-600 rounded dark:text-white">
          <span>${service.name}</span>
          <div class="actions">
            <i class="fas fa-trash text-red-500" onclick="deleteService('${service.name}')"></i>
            <i class="fas fa-edit text-blue-500" onclick="editService('${service.name}', '${service.description}', ${service.price})"></i>
            <i class="fas fa-eye text-green-500" onclick="viewService('${service.name}', '${service.description}', ${service.price})"></i>
          </div>
        </div>
      `).join('');

      serviceTableBody.innerHTML = data.services.map(service => `
        <tr>
          <td>${service.name}</td>
          <td>${service.description}</td>
          <td>${service.price}</td>
          <td class="actions">
            <i class="fas fa-trash text-red-500 hover:text-red-700 cursor-pointer" onclick="deleteService('${service.name}')"></i>
            <i class="fas fa-edit text-blue-500 hover:text-blue-700 cursor-pointer ml-2" onclick="editService('${service.name}', '${service.description}', ${service.price})"></i>
            <i class="fas fa-eye text-green-500 hover:text-green-700 cursor-pointer ml-2" onclick="viewService('${service.name}', '${service.description}', ${service.price})"></i>
          </td>
        </tr>
      `).join('');
    }

    // Delete Product
    async function deleteProduct(productName, productType) {
      if (confirm(`Are you sure you want to delete ${productName} (${productType})?`)) {
        const response = await fetch(`${backendUrl}/products/${productName}/${productType}`, {
          method: 'DELETE',
        });

        if (response.ok) {
          alert('Product deleted successfully!');
          fetchProducts(); // Refresh the product list
        } else {
          alert('Failed to delete product');
        }
      }
    }

    // Function to delete stock item
async function deleteStockItem(productName, productType) {
  if (confirm(`Are you sure you want to delete ${productName} (${productType})?`)) {
    const response = await fetch(`${backendUrl}/stock/${productName}/${productType}`, {
      method: 'DELETE',
    });

    if (response.ok) {
      alert(`${productName} (${productType}) deleted successfully!`);
      fetchStock(); // Refresh the stock table
    } else {
      alert('Failed to delete stock item');
    }
  }
}

    // Delete Service
    async function deleteService(serviceName) {
      if (confirm(`Are you sure you want to delete ${serviceName}?`)) {
        const response = await fetch(`${backendUrl}/services/${serviceName}`, {
          method: 'DELETE',
        });

        if (response.ok) {
          alert('Service deleted successfully!');
          fetchServices(); // Refresh the services list
        } else {
          alert('Failed to delete service');
        }
      }
    }

    // Edit Product
    function editProduct(name, type, buyingPrice, sellingPrice) {
      document.getElementById('addProductModal').classList.remove('hidden');
      const form = document.getElementById('addProductForm');
      form[0].value = name;
      form[1].value = type;
      form[2].value = buyingPrice;
      form[3].value = sellingPrice;

      form.onsubmit = async (e) => {
        e.preventDefault();
        const productName = e.target[0].value;
        const productType = e.target[1].value;
        const buyingPrice = parseFloat(e.target[2].value);
        const sellingPrice = parseFloat(e.target[3].value);

        const response = await fetch(`${backendUrl}/products/${name}/${type}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            name: productName,
            type: productType,
            buying_price: buyingPrice,
            selling_price: sellingPrice
          })
        });

        if (response.ok) {
          alert('Product updated successfully!');
          e.target.reset();
          closeModal('addProductModal');
          fetchProducts();
        } else {
          alert('Failed to update product');
        }
      };
    }
   // Function to edit stock item
// Function to edit stock item
function editStockItem(productName, productType, quantity, pricePerUnit) {
  document.getElementById('editStockModal').classList.remove('hidden');
  document.getElementById('editProductName').value = productName;
  document.getElementById('editProductType').value = productType;
  document.getElementById('editQuantity').value = quantity;
  document.getElementById('editPricePerUnit').value = pricePerUnit;

  const form = document.getElementById('editStockForm');
  form.onsubmit = async (e) => {
    e.preventDefault();
    const updatedQuantity = parseFloat(document.getElementById('editQuantity').value);
    const updatedPricePerUnit = parseFloat(document.getElementById('editPricePerUnit').value);

    const response = await fetch(`${backendUrl}/stock/${productName}/${productType}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        quantity: updatedQuantity,
        price_per_unit: updatedPricePerUnit,
      }),
    });

    if (response.ok) {
      alert(`${productName} (${productType}) updated successfully!`);
      closeModal('editStockModal');
      fetchStock(); // Refresh the stock table
    } else {
      const errorData = await response.json(); // Log the error details
      console.error('Error updating stock item:', errorData);
      alert('Failed to update stock item');
    }
  };
}
    
    // Edit Service
    function editService(name, description, price) {
      document.getElementById('addServiceModal').classList.remove('hidden');
      const form = document.getElementById('addServiceForm');
      form[0].value = name;
      form[1].value = description;
      form[2].value = price;

      form.onsubmit = async (e) => {
        e.preventDefault();
        const serviceName = e.target[0].value;
        const serviceDescription = e.target[1].value;
        const servicePrice = parseFloat(e.target[2].value);

        const response = await fetch(`${backendUrl}/services/${name}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            name: serviceName,
            description: serviceDescription,
            price: servicePrice
          })
        });

        if (response.ok) {
          alert('Service updated successfully!');
          e.target.reset();
          closeModal('addServiceModal');
          fetchServices();
        } else {
          alert('Failed to update service');
        }
      };
    }

    // View Stock Item Details
    function viewStockItem(productName, productType, quantity, pricePerUnit) {
      alert(`
        Product Name: ${productName}
        Product Type: ${productType}
        Quantity: ${quantity}
        Price Per Unit: UGX ${pricePerUnit.toLocaleString()}
        Total Invested: UGX ${(quantity * pricePerUnit).toLocaleString()}
      `);
    }

    // View Service Details
    function viewService(name, description, price) {
      alert(`
        Service Name: ${name}
        Description: ${description}
        Price: UGX ${price.toLocaleString()}
      `);
    }

    // Show Product Details
    function showProductDetails(name, type, buyingPrice, sellingPrice) {
      document.getElementById('productDetailsTitle').textContent = name;
      document.getElementById('productType').textContent = type;
      document.getElementById('buyingPrice').textContent = buyingPrice;
      document.getElementById('sellingPrice').textContent = sellingPrice;
      document.getElementById('markupProfit').textContent = (sellingPrice - buyingPrice).toFixed(2);
      document.getElementById('productDetailsModal').classList.remove('hidden');
    }

    // Automatic Selling Price Calculation
    document.getElementById('buyingPriceInput').addEventListener('input', (e) => {
      const buyingPrice = parseFloat(e.target.value);
      if (!isNaN(buyingPrice)) {
        const sellingPrice = buyingPrice * 1.1; // 10% markup
        document.getElementById('sellingPriceInput').value = sellingPrice.toFixed(2);
      }
    });
    // On page load, fetch the total investment from the backend
document.addEventListener('DOMContentLoaded', async () => {
  const response = await fetch(`${backendUrl}/total_investment/`);
  const data = await response.json();
  const totalInvestment = data.total_investment || 0;

  const totalInvestmentElement = document.querySelector('.finance-item:nth-child(2) .amount-box');
  if (totalInvestmentElement) {
    totalInvestmentElement.textContent = `UGX ${totalInvestment.toLocaleString()}`;
  }
});
    document.addEventListener('DOMContentLoaded', () => {
    fetchBankAccountBalance();
    fetchTotalInvestment();
    fetchTotalStock(); // Add this line
});
    // Function to fetch and display the total amount in stock
async function fetchTotalStock() {
    const response = await fetch(`${backendUrl}/total_stock/`);
    const data = await response.json();
    const totalStock = data.total_stock || 0;

    const totalStockElement = document.querySelector('.finance-item:nth-child(3) .amount-box');
    if (totalStockElement) {
        totalStockElement.textContent = `UGX ${totalStock.toLocaleString()}`;
    }
}

// Initialize
fetchTotalStock();
    // Function to update the total invested amount in the finance card
async function updateTotalInvested() {
  const response = await fetch(`${backendUrl}/total_investment/`);
  const data = await response.json();
  const totalInvestment = data.total_investment || 0;

  const totalInvestmentElement = document.querySelector('.finance-item:nth-child(2) .amount-box');
  if (totalInvestmentElement) {
    totalInvestmentElement.textContent = `UGX ${totalInvestment.toLocaleString()}`;
  }
}
    // Function to open the transaction history modal
function openTransactionHistoryModal() {
  document.getElementById('transactionHistoryModal').classList.remove('hidden');
  fetchTransactionHistory();
}

// Function to fetch transaction history from the backend
async function fetchTransactionHistory() {
  try {
    const response = await fetch(`${backendUrl}/transactions/`);
    const data = await response.json();
    const transactionHistoryTableBody = document.getElementById('transactionHistoryTableBody');
    transactionHistoryTableBody.innerHTML = data.transactions.map(transaction => `
      <tr>
        <td>${transaction.date}</td>
        <td>${transaction.type}</td>
        <td>UGX ${transaction.amount.toLocaleString()}</td>
        <td>${transaction.purpose}</td>
      </tr>
    `).join('');
  } catch (error) {
    console.error('Error fetching transaction history:', error);
  }
}

// Function to close the modal
function closeModal(modalId) {
  document.getElementById(modalId).classList.add('hidden');
}
   async function fetchNetProfit() {
    try {
        const response = await fetch(`${backendUrl}/net_profit/`);
        const data = await response.json();
        const netProfit = data.net_profit || 0;

        // Update the net profit in the finance card
        document.getElementById('netProfitAmount').textContent = `UGX ${netProfit.toLocaleString()}`;
    } catch (error) {
        console.error('Error fetching net profit:', error);
    }
}

// Call the function to fetch and display net profit on page load
document.addEventListener('DOMContentLoaded', () => {
    fetchNetProfit();
});
    // Fetch and Display Last 3 Transactions
    async function fetchLast3Transactions() {
      try {
        const response = await fetch(`${backendUrl}/transactions/`);
        const data = await response.json();
        const transactions = data.transactions.slice(0, 3); // Get the last 3 transactions

        const recentTransactions = document.getElementById('recentTransactions');
        recentTransactions.innerHTML = transactions.map(transaction => `
          <li class="flex justify-between items-center p-2 border-b dark:border-gray-700">
            <span>${transaction.date}</span>
            <span>${transaction.type}</span>
            <span>UGX ${transaction.amount.toLocaleString()}</span>
            <span>${transaction.purpose}</span>
          </li>
        `).join('');
      } catch (error) {
        console.error('Error fetching transactions:', error);
      }
    }

    async function fetchNotifications() {
  try {
    // Fetch all notifications
    const response = await fetch(`${backendUrl}/notifications/`);
    const data = await response.json();
    const notifications = data.notifications;

    // Fetch unread notifications count
    const unreadResponse = await fetch(`${backendUrl}/notifications/unread/`);
    const unreadData = await unreadResponse.json();
    const unreadCount = unreadData.unread_count;

    // Update notification count badge
    const notificationCount = document.getElementById('notification-count');
    notificationCount.textContent = unreadCount;

    // Show or hide the badge
    if (unreadCount > 0) {
      notificationCount.style.display = 'inline-block'; // Show the badge
    } else {
      notificationCount.style.display = 'none'; // Hide the badge
    }

    // Populate notification list
    const notificationList = document.getElementById('notification-list');
    notificationList.innerHTML = notifications.map(notification => `
      <div class="notification-item ${notification.is_read ? '' : 'unread'}">
        <p>${notification.message}</p>
        <small>${new Date(notification.created_at).toLocaleString()}</small>
      </div>
    `).join('');
  } catch (error) {
    console.error('Error fetching notifications:', error);
  }
}

// Mark notifications as read
async function markNotificationsAsRead() {
  try {
    await fetch(`${backendUrl}/notifications/mark_as_read/`, {
      method: 'PUT',
    });
    fetchNotifications(); // Refresh the notifications
  } catch (error) {
    console.error('Error marking notifications as read:', error);
  }
}

// Toggle notifications dropdown
function toggleNotifications() {
  const notificationList = document.getElementById('notification-list');
  notificationList.classList.toggle('hidden');

  // Mark notifications as read when the dropdown is opened
  if (!notificationList.classList.contains('hidden')) {
    markNotificationsAsRead();
  }
}

// Poll for new notifications every 10 seconds
setInterval(fetchNotifications, 10000);

// Fetch notifications on page load
document.addEventListener('DOMContentLoaded', fetchNotifications);

    // Function to fetch and update overview data
async function fetchOverviewData() {
    try {
        // Fetch total sales
        const totalSalesResponse = await fetch(`${backendUrl}/sales/`);
        const totalSalesData = await totalSalesResponse.json();
        const totalSales = totalSalesData.sales.reduce((sum, sale) => sum + sale.total_amount, 0);
        document.getElementById('totalSales').textContent = totalSales.toLocaleString();

        // Fetch gross profit
        const grossProfitResponse = await fetch(`${backendUrl}/gross_profit/`);
        const grossProfitData = await grossProfitResponse.json();
        document.getElementById('grossProfit').textContent = grossProfitData.gross_profit.toLocaleString();

        // Fetch total expenses
        const totalExpensesResponse = await fetch(`${backendUrl}/expenses/`);
        const totalExpensesData = await totalExpensesResponse.json();
        const totalExpenses = totalExpensesData.expenses.reduce((sum, expense) => sum + expense.total, 0);
        document.getElementById('totalExpenses').textContent = totalExpenses.toLocaleString();

        // Use the same values as the finance card for net profit and stock balance
        const netProfitAmount = document.getElementById('netProfitAmount').textContent;
        const stockBalanceAmount = document.querySelector('.finance-item:nth-child(3) .amount-box').textContent;

        // Update the overview section with the finance card values
        document.getElementById('netProfit').textContent = netProfitAmount;
        document.getElementById('stockBalance').textContent = stockBalanceAmount;

        console.log("Overview section updated with finance card values:");
        console.log("Net Profit:", netProfitAmount);
        console.log("Stock Balance:", stockBalanceAmount);
    } catch (error) {
        console.error('Error fetching overview data:', error);
    }
}

// Fetch overview data on page load
document.addEventListener('DOMContentLoaded', fetchOverviewData);

// Poll for updates every 10 seconds
setInterval(fetchOverviewData, 10000);
    
    function openPaymentAcquisitionModal() {
    document.getElementById('paymentAcquisitionModal').classList.remove('hidden');
  }

  document.getElementById('paymentAcquisitionForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const payerName = e.target[0].value;
    const payerAddress = e.target[1].value;
    const payerPhone = e.target[2].value;
    const payerEmail = e.target[3].value;
    const paymentRefNumber = e.target[4].value;
    const paymentDate = e.target[5].value;
    const paymentMethod = e.target[6].value;
    const amountPaid = e.target[7].value;
    const paymentDescription = e.target[8].value;

    // Generate PDF
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Add Logo
    const logo = await loadImage('Itech-computers-logo1.webp');
    doc.addImage(logo, 'PNG', 10, 10, 50, 20);

    // Payment Receipt Header
    doc.setFontSize(18);
    doc.text("PAYMENT RECEIPT", 10, 40);

    // Payer Details
    doc.setFontSize(12);
    doc.text(`Payer Name: ${payerName}`, 10, 50);
    doc.text(`Payer Address: ${payerAddress}`, 10, 60);
    doc.text(`Payer Phone: ${payerPhone}`, 10, 70);
    doc.text(`Payer Email: ${payerEmail}`, 10, 80);

    // Payment Details
    doc.text(`Payment Reference Number: ${paymentRefNumber}`, 10, 90);
    doc.text(`Payment Date: ${paymentDate}`, 10, 100);
    doc.text(`Payment Method: ${paymentMethod}`, 10, 110);
    doc.text(`Amount Paid: ${amountPaid}`, 10, 120);

    // Payment Description
    doc.text(`Payment Description:`, 10, 130);
    doc.setFontSize(10);
    doc.text(paymentDescription, 10, 140, { maxWidth: 180 });

    // Save PDF
    doc.save(`Payment_Receipt_${paymentRefNumber}.pdf`);

    closeModal('paymentAcquisitionModal');
  });

  async function loadImage(src) {
    return new Promise((resolve) => {
      const img = new Image();
      img.src = src;
      img.onload = () => resolve(img);
    });
  }
    async function fetchPendingTasks() {
  try {
    // Show loading indicator
    const pendingTasksList = document.getElementById('pendingTasksList');
    pendingTasksList.innerHTML = `
      <div class="loading-container">
        <div class="loading"></div>
      </div>
    `;

    const response = await fetch(`${backendUrl}/tasks/`);
    const data = await response.json();
    const pendingTasks = data.tasks.filter(task => task.status === 'pending');

    if (pendingTasks.length === 0) {
      pendingTasksList.innerHTML = `
        <p class="text-center text-gray-500 dark:text-gray-400">No pending tasks</p>
      `;
    } else {
      pendingTasksList.innerHTML = pendingTasks.map(task => `
        <details class="bg-gray-100 dark:bg-gray-700 p-2 rounded">
          <summary class="cursor-pointer font-semibold dark:text-white">${task.title}</summary>
          <div class="mt-2">
            <p class="text-sm text-gray-600 dark:text-gray-400">${task.content}</p>
            <p class="text-xs text-gray-500 dark:text-gray-300">${task.date}</p>
          </div>
        </details>
      `).join('');
    }
  } catch (error) {
    console.error('Error fetching pending tasks:', error);
    document.getElementById('pendingTasksList').innerHTML = `
      <p class="text-center text-red-500">Error loading tasks. Please try again later.</p>
    `;
  }
}

// Call fetchPendingTasks when the page loads
document.addEventListener('DOMContentLoaded', fetchPendingTasks);

// Refresh tasks every 30 seconds
setInterval(fetchPendingTasks, 30000);
    
    
    // Fetch and Display Sales Analysis (Last 6 Months)


    
    
    // Initialize
    fetchProducts();
    fetchStock();
    fetchServices();
    fetchTotalInvestment();
    updateTotalInvested();
  </script>
</body>
</html>
